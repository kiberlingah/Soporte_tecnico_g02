<app-nav-tecnicos></app-nav-tecnicos>
<div class="title7 text-center mt-5">

    <p class="mb-2 title_seccion1">
        Citas de Diagnóstico
    </p>
    <div style="width: 60px; height: 4px; background: #905BF4; border-radius: 4px; margin: 0 auto 25px auto;"></div>
    <p class="mb-2" style="font-family: 'Rajdhani', sans-serif; font-size: 1rem; color: #1d253a;">
        Consulte las citas de diagnóstico y asigne un tecnico para la solicitud de los clientes.
    </p>
</div>
<div class="historial-wrapper container mb-5 mt-4">

    <div class="row g-2 mb-4">

        <!-- Buscador -->
        <div class="col-md-3">
            <input type="text" class="form-control" placeholder="Buscar..." [(ngModel)]="searchText">
        </div>

        <!-- Filtro por Servicio -->
        <div class="col-md-3">
            <select class="form-select" [(ngModel)]="filtroServicio">
                <option value="">Todos los servicios</option>
                <option *ngFor="let s of servicios" [value]="s.id">{{ s.descripcion_servicio }}</option>
            </select>
        </div>

        <!-- Filtro por Distrito -->
        <div class="col-md-3">
            <select class="form-select" [(ngModel)]="filtroDistrito">
                <option value="">Todos los distritos</option>
                <option *ngFor="let d of distritos" [value]="d.id">{{ d.nombre_distrito }}</option>
            </select>
        </div>

        <!--Filtro de modalidad-->
        <div class="col-md-3">
            <select class="form-select" [(ngModel)]="filtroModalidad">
                <option value="">Todas las modalidades</option>
                <option *ngFor="let m of modalidades" [value]="m.id">{{ m.nombre_modalidad }}</option>
            </select>
        </div>

    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-striped align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Cliente</th>
                            <th>Servicio</th>
                            <th>Atención</th>
                            <th>Modalidad</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr *ngFor="let c of listaCitasPendientes | buscar: searchText
            | paginate: { itemsPerPage: itemsPerPage, currentPage: page }
            " [hidden]="
              (filtroServicio && c.id_servicio != filtroServicio) ||
              (filtroDistrito && c.id_distrito != filtroDistrito) ||
              (filtroModalidad && c.id_modalidad != filtroModalidad)
            ">
                            <td>{{c.id_cita}}</td>
                            <td>
                                {{ getClientes(c.id_cliente) }} <br>
                                <!-- <span class="badge bg-info">Registrado: {{pago.fecha_pago}} </span> -->
                            </td>
                            <td>
                                {{ getServicioDesc(c.id_servicio) }} <br>
                                <!-- <span class="badge bg-info">Registrado: {{pago.fecha_pago}} </span> -->
                            </td>

                            <td>
                                Fecha: {{c.fecha_atencion}} <br>
                                <span class="text-primary">Horario: {{getHorario(c.id_horario)}}</span>
                            </td>

                            <td>
                                {{getModalidadNombre(c.id_modalidad)}} <br>
                                <span class="badge bg-secondary">{{c.direccion}}</span><br>
                                <span class="badge bg-warning">{{getDistritoNombre(c.id_distrito)}}</span>
                            </td>


                            <td class="text-end">
                                <button class="btn btn-sm btn-primary" (click)="abrirModal(c.id_cita)">Más
                                    detalles</button>
                                <!--(click)="abrirModal()"-->
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="p-3 text-center">
                <pagination-controls (pageChange)="page = $event" previousLabel="Anterior" nextLabel="Siguiente">
                </pagination-controls>
            </div>
        </div>
    </div>
</div>

<app-footer-simple></app-footer-simple>


<div class="modal fade" id="modalDetalleCita" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Detalle de Cita #{{ citaSeleccionada?.id_cita }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <form *ngIf="citaSeleccionada">

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Cliente</label>
                            <input class="form-control" [value]="getClientes(citaSeleccionada.id_cliente)" disabled />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Servicio</label>
                            <input class="form-control" [value]="getServicioDesc(citaSeleccionada.id_servicio)"
                                disabled />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Fecha de Atención</label>
                            <input class="form-control" [value]="citaSeleccionada.fecha_atencion" disabled />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Horario</label>
                            <input class="form-control" [value]="getHorario(citaSeleccionada.id_horario)" disabled />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Comentario del Cliente</label>
                        <textarea class="form-control" rows="3" [value]="citaSeleccionada.comentario_cliente"
                            disabled></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Observación del Técnico</label>
                        <textarea class="form-control" [(ngModel)]="citaSeleccionada.observacion_tecnico" name="obs"></textarea>
                    </div>
                </form>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-success" (click)="guardarCambios()">Guardar comnetarios</button>
            </div>

        </div>
    </div>
</div>