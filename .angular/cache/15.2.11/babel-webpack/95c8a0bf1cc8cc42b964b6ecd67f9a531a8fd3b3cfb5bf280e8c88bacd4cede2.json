{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet ServiciosComponent = class ServiciosComponent {\n  constructor(modalidadService, distritoService, horarioService, servicioService, tarifaService, clienteService) {\n    this.modalidadService = modalidadService;\n    this.distritoService = distritoService;\n    this.horarioService = horarioService;\n    this.servicioService = servicioService;\n    this.tarifaService = tarifaService;\n    this.clienteService = clienteService;\n    this.servicios = [];\n    //programasInstalacion: any[] = [];\n    //programasReparacion: any[] = [];\n    this.modalidades = [];\n    this.distritos = [];\n    this.horarios = [];\n    this.tarifasDistritos = [];\n    this.cliente = {};\n    this.nombreCompleto = '';\n    this.servicio = {\n      descripcion_servicio: '',\n      modalidad: '',\n      distrito: '',\n      direccion: '',\n      fecha: '',\n      hora: '',\n      id_cliente: this.cliente.id_cliente,\n      dni: '',\n      comentario: '',\n      precio: 0.00\n    };\n    this.idServicioSeleccionado = '';\n    this.precioSeleccionado = 0.00;\n  }\n  ngOnInit() {\n    // Cargar modalidades\n    this.modalidadService.getModalidades().subscribe({\n      next: d => this.modalidades = d,\n      error: err => console.error('Error al cargar modalidades:', err)\n    });\n    // Cargar distritos\n    this.distritoService.listar().subscribe({\n      next: d => this.distritos = d,\n      error: err => console.error('Error al cargar distritos:', err)\n    });\n    // Cargar horarios\n    this.horarioService.listar().subscribe({\n      next: h => this.horarios = h,\n      error: err => console.error('Error al cargar horarios:', err)\n    });\n    // Cargar tarifas por distrito\n    this.tarifaService.listar().subscribe({\n      next: t => this.tarifasDistritos = t,\n      error: err => console.error('Error al cargar tarifas:', err)\n    });\n    this.servicioService.getServiciosInstalacion().subscribe({\n      next: s => this.servicios = s,\n      error: err => console.error('Error al cargar instalación:', err)\n    });\n    // // Cargar programas de reparación\n    // this.servicioService.getServiciosReparacion().subscribe({\n    //   next: (d: any[]) => this.programasReparacion = d,\n    //   error: (err: any) => console.error('Error al cargar reparación:', err)\n    // });\n    const token = localStorage.getItem('token');\n    const idCliente = Number(localStorage.getItem('id_cliente'));\n    if (token && idCliente) {\n      this.clienteService.obtenerCliente(idCliente, token).subscribe({\n        next: data => {\n          this.cliente = data;\n          this.nombreCompleto = `${this.cliente.nombres} ${this.cliente.apellidos}`;\n          this.servicio.id_cliente = this.cliente.id_cliente;\n        },\n        error: err => console.error('Error al cargar cliente:', err)\n      });\n    }\n  }\n  // actualizarPrecio(): void {\n  //   // Precio base del servicio\n  //   const servicio = [...this.programasInstalacion, ...this.programasReparacion]\n  //     .find(s => s.id_servicio === this.servicio.programa);\n  //   // Tarifa adicional por distrito\n  //   const tarifa = this.tarifasDistritos.find(t => t.id_distrito === this.servicio.distrito);\n  //   const precioServicio = servicio ? servicio.precio : 0;\n  //   const precioDistrito = tarifa ? tarifa.precio : 0;\n  //   this.servicio.precio = precioServicio + precioDistrito;\n  // }\n  // setearPrecio(idServicio: any): void {\n  //   //console.log(this.servicios.id_servicio);\n  //    if (idServicio) {\n  //     const servicioSeleccionado = this.servicios.find(\n  //     (servicio: {idServicio: Number}) => servicio.id_servicio == idServicio\n  //   );\n  //   console.log('Servicio seleccionado:', servicioSeleccionado);\n  //   this.servicio.precio = servicioSeleccionado ? servicioSeleccionado.precio : 0;\n  //   console.log('Precio actualizado:', this.servicio.precio);\n  //    }\n  //    this.servicio.precio = 0;\n  //      console.log('Precio cero:', this.servicio.precio);\n  //      return;\n  // }\n  setearPrecio() {\n    const servicio = this.servicios.find(s => s.id_servicio == this.idServicioSeleccionado);\n    console.log('Servicio seleccionado:', servicio);\n    this.precioSeleccionado = servicio ? parseFloat(servicio.precio) : 0.00;\n    console.log('Precio actualizado:', this.precioSeleccionado);\n  }\n  validarModalidad() {\n    if (this.servicio.modalidad != 3) {\n      this.servicio.distrito = '';\n      this.servicio.direccion = '';\n    }\n  }\n  get precioServicio() {\n    const n = Number(this.precioSeleccionado) || 0;\n    return n.toFixed(2); // o n.toLocaleString('es-PE', {minimumFractionDigits:2})\n  }\n\n  registrarServicio() {\n    if (!this.formularioValido()) {\n      alert('⚠️ Completa todos los campos obligatorios antes de registrar el servicio.');\n      return;\n    }\n    this.servicioService.registrarServicio(this.servicio).subscribe({\n      next: () => alert('✅ Servicio registrado correctamente'),\n      error: err => console.error('Error al registrar servicio:', err)\n    });\n  }\n  formularioValido() {\n    return this.servicio.programa && this.servicio.distrito && this.servicio.precio > 0;\n  }\n};\nServiciosComponent = __decorate([Component({\n  selector: 'app-servicios',\n  templateUrl: './servicios.component.html',\n  styleUrls: ['./servicios.component.scss']\n})], ServiciosComponent);\nexport { ServiciosComponent };","map":{"version":3,"mappings":"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","names":["Component","ServiciosComponent","constructor","modalidadService","distritoService","horarioService","servicioService","tarifaService","clienteService","descripcion_servicio","modalidad","distrito","direccion","fecha","hora","id_cliente","cliente","dni","comentario","precio","ngOnInit","getModalidades","subscribe","next","d","modalidades","error","err","console","listar","distritos","h","horarios","t","tarifasDistritos","getServiciosInstalacion","s","servicios","token","localStorage","getItem","idCliente","Number","obtenerCliente","data","nombreCompleto","nombres","apellidos","servicio","setearPrecio","find","id_servicio","idServicioSeleccionado","log","precioSeleccionado","parseFloat","validarModalidad","precioServicio","n","toFixed","registrarServicio","formularioValido","alert","programa","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["G:\\FrontendReyshell\\proyecto-web-soporte\\src\\app\\client-portal\\servicios\\servicios.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { ModalidadService } from 'src/app/services/modalidad.service';\r\nimport { DistritoService } from 'src/app/services/distrito.service';\r\nimport { HorarioService } from 'src/app/services/horario.service';\r\nimport { ServicioService } from 'src/app/services/servicio.service';\r\nimport { TarifaService } from 'src/app/services/tarifa.service';\r\nimport { ClienteService } from 'src/app/services/cliente.service';\r\n\r\n@Component({\r\n  selector: 'app-servicios',\r\n  templateUrl: './servicios.component.html',\r\n  styleUrls: ['./servicios.component.scss']\r\n})\r\nexport class ServiciosComponent implements OnInit {\r\n  servicios: any[] = [];\r\n  //programasInstalacion: any[] = [];\r\n  //programasReparacion: any[] = [];\r\n  modalidades: any[] = [];\r\n  distritos: any[] = [];\r\n  horarios: any[] = [];\r\n  tarifasDistritos: any[] = [];\r\n  cliente: any = {};\r\n  nombreCompleto: string = '';\r\n\r\n  servicio: any = {\r\n    descripcion_servicio: '',\r\n    modalidad: '',\r\n    distrito: '',\r\n    direccion: '',\r\n    fecha: '',\r\n    hora: '',\r\n    id_cliente: this.cliente.id_cliente,\r\n    dni: '',\r\n    comentario: '',\r\n    precio: 0.00,\r\n  };\r\n  \r\n\r\nidServicioSeleccionado: any = '';\r\nprecioSeleccionado: number = 0.00;\r\n\r\n\r\n\r\n  constructor(\r\n    private modalidadService: ModalidadService,\r\n    private distritoService: DistritoService,\r\n    private horarioService: HorarioService,\r\n    private servicioService: ServicioService,\r\n    private tarifaService: TarifaService,\r\n    private clienteService: ClienteService\r\n  ) { }\r\n\r\n  ngOnInit(): void {\r\n    // Cargar modalidades\r\n    this.modalidadService.getModalidades().subscribe({\r\n      next: (d: any[]) => this.modalidades = d,\r\n      error: (err: any) => console.error('Error al cargar modalidades:', err)\r\n    });\r\n\r\n    // Cargar distritos\r\n    this.distritoService.listar().subscribe({\r\n      next: (d: any[]) => this.distritos = d,\r\n      error: (err: any) => console.error('Error al cargar distritos:', err)\r\n    });\r\n\r\n    // Cargar horarios\r\n    this.horarioService.listar().subscribe({\r\n      next: (h: any[]) => this.horarios = h,\r\n      error: (err: any) => console.error('Error al cargar horarios:', err)\r\n    });\r\n\r\n    // Cargar tarifas por distrito\r\n    this.tarifaService.listar().subscribe({\r\n      next: (t: any[]) => this.tarifasDistritos = t,\r\n      error: (err: any) => console.error('Error al cargar tarifas:', err)\r\n    });\r\n    \r\n    this.servicioService.getServiciosInstalacion().subscribe({\r\n      next: (s: any[]) => this.servicios = s,\r\n      error: (err: any) => console.error('Error al cargar instalación:', err)\r\n    });\r\n\r\n\r\n    // // Cargar programas de reparación\r\n    // this.servicioService.getServiciosReparacion().subscribe({\r\n    //   next: (d: any[]) => this.programasReparacion = d,\r\n    //   error: (err: any) => console.error('Error al cargar reparación:', err)\r\n    // });\r\n\r\n    const token = localStorage.getItem('token');\r\n    const idCliente = Number(localStorage.getItem('id_cliente'));\r\n\r\n    if (token && idCliente) {\r\n      this.clienteService.obtenerCliente(idCliente, token).subscribe({\r\n        next: data => {\r\n          this.cliente = data;\r\n          this.nombreCompleto = `${this.cliente.nombres} ${this.cliente.apellidos}`;\r\n          this.servicio.id_cliente = this.cliente.id_cliente;\r\n        },\r\n        error: err => console.error('Error al cargar cliente:', err)\r\n      });\r\n    }\r\n  }\r\n\r\n  // actualizarPrecio(): void {\r\n  //   // Precio base del servicio\r\n  //   const servicio = [...this.programasInstalacion, ...this.programasReparacion]\r\n  //     .find(s => s.id_servicio === this.servicio.programa);\r\n\r\n  //   // Tarifa adicional por distrito\r\n  //   const tarifa = this.tarifasDistritos.find(t => t.id_distrito === this.servicio.distrito);\r\n\r\n  //   const precioServicio = servicio ? servicio.precio : 0;\r\n  //   const precioDistrito = tarifa ? tarifa.precio : 0;\r\n\r\n  //   this.servicio.precio = precioServicio + precioDistrito;\r\n  // }\r\n  // setearPrecio(idServicio: any): void {\r\n  //   //console.log(this.servicios.id_servicio);\r\n  //    if (idServicio) {\r\n  //     const servicioSeleccionado = this.servicios.find(\r\n  //     (servicio: {idServicio: Number}) => servicio.id_servicio == idServicio\r\n  //   );\r\n  //   console.log('Servicio seleccionado:', servicioSeleccionado);\r\n\r\n  //   this.servicio.precio = servicioSeleccionado ? servicioSeleccionado.precio : 0;\r\n  //   console.log('Precio actualizado:', this.servicio.precio);\r\n      \r\n  //    }\r\n  //    this.servicio.precio = 0;\r\n  //      console.log('Precio cero:', this.servicio.precio);\r\n  //      return;\r\n    \r\n  // }\r\n  setearPrecio(): void {\r\n  const servicio = this.servicios.find(s => s.id_servicio == this.idServicioSeleccionado);\r\n  console.log('Servicio seleccionado:', servicio);\r\n  this.precioSeleccionado = servicio ? parseFloat(servicio.precio) : 0.00;\r\n  console.log('Precio actualizado:', this.precioSeleccionado);\r\n}\r\n\r\nvalidarModalidad() {\r\n  if (this.servicio.modalidad != 3) {\r\n    this.servicio.distrito = '';\r\n    this.servicio.direccion = '';\r\n  }\r\n}\r\n\r\nget precioServicio(): string {\r\n  const n = Number(this.precioSeleccionado) || 0;\r\n  return n.toFixed(2); // o n.toLocaleString('es-PE', {minimumFractionDigits:2})\r\n}\r\n\r\n\r\n  registrarServicio(): void {\r\n    if (!this.formularioValido()) {\r\n      alert('⚠️ Completa todos los campos obligatorios antes de registrar el servicio.');\r\n      return;\r\n    }\r\n\r\n    this.servicioService.registrarServicio(this.servicio).subscribe({\r\n      next: () => alert('✅ Servicio registrado correctamente'),\r\n      error: (err: any) => console.error('Error al registrar servicio:', err)\r\n    });\r\n  }\r\n\r\n  formularioValido(): boolean {\r\n    return this.servicio.programa && this.servicio.distrito && this.servicio.precio > 0;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}