{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../services/cliente.service\";\nexport class AuthService {\n  constructor(router, clienteService) {\n    this.router = router;\n    this.clienteService = clienteService;\n    this.role = null;\n  }\n  // Simulación de login\n  loginMock(rol) {\n    this.role = rol;\n    localStorage.setItem('rol', rol);\n    localStorage.setItem('token', 'fake-token-123'); // token simulado\n    this.redirectHomeByRole(); // redirige según rol\n  }\n\n  loginReal(correo, password) {\n    this.clienteService.loginCliente({\n      correo,\n      password\n    }).subscribe({\n      next: resp => {\n        if (resp.success) {\n          // Guardar token\n          localStorage.setItem('token', resp.token);\n          // Guardar el id_cliente real\n          localStorage.setItem('id_cliente', resp.id_cliente);\n          // Guardar el rol\n          localStorage.setItem('rol', 'cliente');\n          this.role = 'cliente';\n          this.redirectHomeByRole();\n        }\n      },\n      error: err => {\n        console.error(\"Error login:\", err);\n      }\n    });\n  }\n  // Obtener rol actual\n  getRole() {\n    return this.role || localStorage.getItem('rol');\n  }\n  obtenerDatosCliente(id) {\n    const token = this.getToken();\n    if (!token) {\n      this.router.navigate(['/login']);\n      throw new Error(\"Usuario no autenticado\");\n    }\n    return this.clienteService.obtenerCliente(id, token);\n  }\n  // Verificar si está logueado\n  isLoggedIn() {\n    return !!this.getRole();\n  }\n  // Obtener token\n  getToken() {\n    return localStorage.getItem('token');\n  }\n  // Redirección según rol (siempre devuelve string)\n  redirectHomeByRole() {\n    const rol = this.getRole();\n    if (rol === 'cliente') {\n      this.router.navigate(['/inicio']);\n      return '/inicio';\n    }\n    if (rol === 'admin') {\n      this.router.navigate(['/admin']);\n      return '/admin';\n    }\n    if (rol === 'tecnico') {\n      this.router.navigate(['/tecnico']);\n      return '/tecnico';\n    }\n    this.router.navigate(['/login']);\n    return '/login';\n  }\n  // Cerrar sesión\n  logout() {\n    this.role = null;\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.ClienteService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["AuthService","constructor","router","clienteService","loginMock","rol","role","localStorage","setItem","redirectHomeByRole","loginReal","correo","password","loginCliente","subscribe","next","resp","success","token","id_cliente","error","err","console","getRole","getItem","obtenerDatosCliente","id","getToken","navigate","Error","obtenerCliente","isLoggedIn","logout","clear","factory","providedIn"],"sourceRoot":"","sources":["G:\\FrontendReyshell\\proyecto-web-soporte\\src\\app\\auth\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { ClienteService } from '../services/cliente.service';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  private role: string | null = null;\r\n\r\n  constructor(private router: Router, private clienteService: ClienteService) {}\r\n\r\n  // Simulación de login\r\n  loginMock(rol: 'cliente' | 'admin' | 'tecnico') {\r\n    this.role = rol;\r\n    localStorage.setItem('rol', rol);\r\n    localStorage.setItem('token', 'fake-token-123'); // token simulado\r\n    \r\n    this.redirectHomeByRole(); // redirige según rol\r\n  }\r\n\r\n  loginReal(correo: string, password: string) {\r\n  this.clienteService.loginCliente({ correo, password }).subscribe({\r\n    next: (resp: any) => {\r\n      if (resp.success) {\r\n        // Guardar token\r\n        localStorage.setItem('token', resp.token);\r\n\r\n        // Guardar el id_cliente real\r\n        localStorage.setItem('id_cliente', resp.id_cliente);\r\n\r\n        // Guardar el rol\r\n        localStorage.setItem('rol', 'cliente');\r\n        this.role = 'cliente';\r\n\r\n        this.redirectHomeByRole();\r\n      }\r\n    },\r\n    error: (err) => {\r\n      console.error(\"Error login:\", err);\r\n    }\r\n  });\r\n}\r\n\r\n  // Obtener rol actual\r\n  getRole(): string | null {\r\n    return this.role || localStorage.getItem('rol');\r\n  }\r\n  \r\n  obtenerDatosCliente(id: number): Observable<any> {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      this.router.navigate(['/login']);\r\n      throw new Error(\"Usuario no autenticado\");\r\n    }\r\n    return this.clienteService.obtenerCliente(id, token);\r\n  }\r\n\r\n  // Verificar si está logueado\r\n  isLoggedIn(): boolean {\r\n    return !!this.getRole();\r\n  }\r\n\r\n  // Obtener token\r\n  getToken(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  // Redirección según rol (siempre devuelve string)\r\n  redirectHomeByRole(): string {\r\n    const rol = this.getRole();\r\n    if (rol === 'cliente') {\r\n      this.router.navigate(['/inicio']);\r\n      return '/inicio';\r\n    }\r\n    if (rol === 'admin') {\r\n      this.router.navigate(['/admin']);\r\n      return '/admin';\r\n    }\r\n    if (rol === 'tecnico') {\r\n      this.router.navigate(['/tecnico']);\r\n      return '/tecnico';\r\n    }\r\n    this.router.navigate(['/login']);\r\n    return '/login';\r\n  }\r\n\r\n  // Cerrar sesión\r\n  logout() {\r\n    this.role = null;\r\n    localStorage.clear();\r\n    this.router.navigate(['/login']);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}